version: '3.8'

services:
  # MongoDB Database
    mongodb:
        image: mongo:6.0
            container_name: ai-operations-mongodb
                environment:
                      MONGO_INITDB_ROOT_USERNAME: admin
                            MONGO_INITDB_ROOT_PASSWORD: password123
                                ports:
                                      - "27017:27017"
                                          volumes:
                                                - mongodb_data:/data/db
                                                    networks:
                                                          - ai-operations-network
                                                              healthcheck:
                                                                    test: echo 'db.runCommand("ping").ok' | mongosh localhost:27017/test --quiet
                                                                          interval: 10s
                                                                                timeout: 5s
                                                                                      retries: 5

                                                                                        # PostgreSQL Database (Alternative)
                                                                                          # postgres:
                                                                                            #   image: postgres:15
                                                                                              #   container_name: ai-operations-postgres
                                                                                                #   environment:
                                                                                                  #     POSTGRES_USER: aiops
                                                                                                    #     POSTGRES_PASSWORD: password123
                                                                                                      #     POSTGRES_DB: ai_operations
                                                                                                        #   ports:
                                                                                                          #     - "5432:5432"
                                                                                                            #   volumes:
                                                                                                              #     - postgres_data:/var/lib/postgresql/data
                                                                                                                #   networks:
                                                                                                                  #     - ai-operations-network
                                                                                                                    #   healthcheck:
                                                                                                                      #     test: ["CMD-SHELL", "pg_isready -U aiops"]
                                                                                                                        #     interval: 10s
                                                                                                                          #     timeout: 5s
                                                                                                                            #     retries: 5
                                                                                                                            
                                                                                                                              # Backend API Server
                                                                                                                                backend:
                                                                                                                                    build:
                                                                                                                                          context: ./backend
                                                                                                                                                dockerfile: Dockerfile
                                                                                                                                                    container_name: ai-operations-backend
                                                                                                                                                        environment:
                                                                                                                                                              NODE_ENV: production
                                                                                                                                                                    PORT: 5000
                                                                                                                                                                          MONGODB_URI: mongodb://admin:password123@mongodb:27017/ai-operations?authSource=admin
                                                                                                                                                                                # DATABASE_URL: postgresql://aiops:password123@postgres:5432/ai_operations
                                                                                                                                                                                      JWT_SECRET: ${JWT_SECRET:-your_secret_key_change_in_production}
                                                                                                                                                                                            OPENAI_API_KEY: ${OPENAI_API_KEY}
                                                                                                                                                                                                  ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
                                                                                                                                                                                                      ports:
                                                                                                                                                                                                            - "5000:5000"
                                                                                                                                                                                                                depends_on:
                                                                                                                                                                                                                      mongodb:
                                                                                                                                                                                                                              condition: service_healthy
                                                                                                                                                                                                                                    # postgres:
                                                                                                                                                                                                                                          #   condition: service_healthy
                                                                                                                                                                                                                                              volumes:
                                                                                                                                                                                                                                                    - ./backend:/app
                                                                                                                                                                                                                                                          - /app/node_modules
                                                                                                                                                                                                                                                              networks:
                                                                                                                                                                                                                                                                    - ai-operations-network
                                                                                                                                                                                                                                                                        healthcheck:
                                                                                                                                                                                                                                                                              test: curl --fail http://localhost:5000/api/health || exit 1
                                                                                                                                                                                                                                                                                    interval: 10s
                                                                                                                                                                                                                                                                                          timeout: 5s
                                                                                                                                                                                                                                                                                                retries: 5
                                                                                                                                                                                                                                                                                                    command: npm run dev
                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                      # Frontend Application
                                                                                                                                                                                                                                                                                                        frontend:
                                                                                                                                                                                                                                                                                                            build:
                                                                                                                                                                                                                                                                                                                  context: ./frontend
                                                                                                                                                                                                                                                                                                                        dockerfile: Dockerfile
                                                                                                                                                                                                                                                                                                                            container_name: ai-operations-frontend
                                                                                                                                                                                                                                                                                                                                environment:
                                                                                                                                                                                                                                                                                                                                      VITE_API_URL: http://localhost:5000
                                                                                                                                                                                                                                                                                                                                            VITE_APP_NAME: AI Operations Agent
                                                                                                                                                                                                                                                                                                                                                ports:
                                                                                                                                                                                                                                                                                                                                                      - "5173:5173"
                                                                                                                                                                                                                                                                                                                                                          depends_on:
                                                                                                                                                                                                                                                                                                                                                                - backend
                                                                                                                                                                                                                                                                                                                                                                    volumes:
                                                                                                                                                                                                                                                                                                                                                                          - ./frontend:/app
                                                                                                                                                                                                                                                                                                                                                                                - /app/node_modules
                                                                                                                                                                                                                                                                                                                                                                                    networks:
                                                                                                                                                                                                                                                                                                                                                                                          - ai-operations-network
                                                                                                                                                                                                                                                                                                                                                                                              command: npm run dev
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                # Redis Cache (Optional)
                                                                                                                                                                                                                                                                                                                                                                                                  # redis:
                                                                                                                                                                                                                                                                                                                                                                                                    #   image: redis:7-alpine
                                                                                                                                                                                                                                                                                                                                                                                                      #   container_name: ai-operations-redis
                                                                                                                                                                                                                                                                                                                                                                                                        #   ports:
                                                                                                                                                                                                                                                                                                                                                                                                          #     - "6379:6379"
                                                                                                                                                                                                                                                                                                                                                                                                            #   volumes:
                                                                                                                                                                                                                                                                                                                                                                                                              #     - redis_data:/data
                                                                                                                                                                                                                                                                                                                                                                                                                #   networks:
                                                                                                                                                                                                                                                                                                                                                                                                                  #     - ai-operations-network
                                                                                                                                                                                                                                                                                                                                                                                                                    #   healthcheck:
                                                                                                                                                                                                                                                                                                                                                                                                                      #     test: ["CMD", "redis-cli", "ping"]
                                                                                                                                                                                                                                                                                                                                                                                                                        #     interval: 10s
                                                                                                                                                                                                                                                                                                                                                                                                                          #     timeout: 5s
                                                                                                                                                                                                                                                                                                                                                                                                                            #     retries: 5
                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                              # Nginx Reverse Proxy (Optional)
                                                                                                                                                                                                                                                                                                                                                                                                                                # nginx:
                                                                                                                                                                                                                                                                                                                                                                                                                                  #   image: nginx:alpine
                                                                                                                                                                                                                                                                                                                                                                                                                                    #   container_name: ai-operations-nginx
                                                                                                                                                                                                                                                                                                                                                                                                                                      #   ports:
                                                                                                                                                                                                                                                                                                                                                                                                                                        #     - "80:80"
                                                                                                                                                                                                                                                                                                                                                                                                                                          #     - "443:443"
                                                                                                                                                                                                                                                                                                                                                                                                                                            #   volumes:
                                                                                                                                                                                                                                                                                                                                                                                                                                              #     - ./nginx.conf:/etc/nginx/nginx.conf:ro
                                                                                                                                                                                                                                                                                                                                                                                                                                                #     - ./ssl:/etc/nginx/ssl:ro
                                                                                                                                                                                                                                                                                                                                                                                                                                                  #   depends_on:
                                                                                                                                                                                                                                                                                                                                                                                                                                                    #     - backend
                                                                                                                                                                                                                                                                                                                                                                                                                                                      #     - frontend
                                                                                                                                                                                                                                                                                                                                                                                                                                                        #   networks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                          #     - ai-operations-network
                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                          volumes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                            mongodb_data:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                driver: local
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  # postgres_data:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    #   driver: local
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      # redis_data:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #   driver: local
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        networks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ai-operations-network:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              driver: bridge
